# 架构特点

- 事件驱动 libuv, 单线程
- 非阻塞 io
- 异步编程

callback

# 局限性

- 性能差 单线程 new Cluser
- 进程守护
- 安全性
- 动态语言
- 生态

## 全局对象 global

- mrequire, module, export, __filename,__dirname
- process, buffer
- console
- setTimeout, clearSetTimeout, setInterval,setImmediate

## 使用场景

- cli, os 文件操作，

## 网络操作

web svr, http client, rpc

## 进程管理

- process
- child-process
- cluster
  
## 事件驱动

events

// 发布订阅

## 项目

1. 技术方案
   1. 需求分析
   2. 设计目标
   3. 技术选型
   4. 技术方案核心阐述
   5. 工作量评估
2. Review
   1. 方案的review
   2. 工期review
3. Coding
4. Testing
   1. 自动化测试
   2. 人工测试
5. deploy(Node.js 服务的部署)
   1. 进程管理 forever, pm2
   2. 指标监控， 内存监控，磁盘监控，CPU监控
   3. 日志监控， 错误日志， 异常日志，调试日志（远程日志，本地日志 ELK）
   4. Trace, trace_id
6. DevOps
   1. ci/cd(持续集成， 持续部署) ， pipline(流水线)
    git push master -> git hook -> pull -> build -> 上传到发布平台 -> 镜像启动 -> 部署完毕

cdn 域名 -> 源站（构建包上传到源站）注： 要刷新边缘节点

## Web Server

### JWT (json web token)

   1. 头部(header)

   > 令牌类型
   > 使用的算法

   2. 载荷(payload)

   > 注册声明， iss签发者， sub主题， exp过期时间， iat 签发时间

   3. 签名

   > 使用base64编码的头部和载荷以及秘钥进行签名
   > 将生成的签名添加到令牌当中

2. 数据库连接

knex 框架

当你有多个请求需要查询同一个数据库时，为了确保连接的高效使用同时保持安全性，你可以采取以下策略：

1. **使用连接池**

连接池是管理数据库连接的一种技术，它允许多个客户端共享一定数量的数据库连接，而不是为每个客户端创建新的连接。这样可以显著减少连接和断开数据库连接的开销，提高应用程序的响应速度和性能。

- **Knex.js**已经内置了连接池管理，你只需在配置中指定连接池的参数。例如：

```javascript
const knex = require('knex')({
  client: 'pg',
  connection: {
    host: '127.0.0.1',
    user: 'your_database_user',
    password: 'your_database_password',
    database: 'myapp_test'
  },
  pool: { min: 2, max: 10 } // 设置连接池的大小
});
```

2. **避免在事务中长时间持有连接**

如果你的查询包含事务操作，确保事务不会长时间运行而占用连接。尽快完成事务并提交或回滚，以释放连接回连接池。

3. **查询优化**

- 优化SQL查询语句，减少数据库的负担。确保使用索引和避免不必要的全表扫描，以加快查询速度。
- 对于复杂查询，考虑是否可以通过调整业务逻辑或分解为多个简单查询来实现。

4. **限制并发查询数量**

如果你的应用可能会同时发起大量数据库查询请求，考虑引入队列机制或限流策略，来控制同时执行的查询数量，避免因为过多的并发请求压垮数据库。

5. **使用只读副本**

对于主要是读操作的高负载环境，如果你的数据库支持，可以使用只读副本来分担主数据库的读取压力。

6. **监控和日志**

- 监控数据库的性能指标，如连接数、查询响应时间等，以便及时发现和解决潜在问题。
- 记录详细的日志信息，对于出现的错误或长时间运行的查询进行分析，以帮助优化数据库操作。

7. **保证安全**

- 确保使用安全的认证机制和加密连接（如SSL/TLS），来保护数据库连接的安全。
- 遵循最小权限原则，确保应用程序使用的数据库用户只拥有执行必要操作的权限。

通过采取以上策略，你可以高效且安全地管理对同一个数据库的多个查询请求，确保应用程序的稳定性和性能。
